<!DOCTYPE html>
<!-- saved from url=(0043)http://hl7.org/fhir/2016May/FHIRPath.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

  <title>Appendix H – Time Interval Calculation Examples</title>

  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="http://cql.hl7.org" name="author"/>

  <link rel="stylesheet" href="dist/fhir.css"/>
  <link rel="Prev" href="history.html"/>

    <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="dist/bootstrap.css"/>
  <link rel="stylesheet" href="dist/bootstrap-fhir.css"/>

    <!-- Project extras -->
  <link rel="stylesheet" href="dist/project.css"/>
  <link rel="stylesheet" href="dist/pygments-manni.css"/>
	<link rel="stylesheet" href="dist/jquery-ui.css"/>
	<link rel="stylesheet" href="dist/cql.css"/>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- [if lt IE 9]>
  <script src="./assets/js/html5shiv.js"></script>
  <script src="./assets/js/respond.min.js"></script>
  <![endif] -->

    <!-- Favicons -->
  <link sizes="144x144" rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-144-precomposed.png"/>
  <link sizes="114x114" rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-114-precomposed.png"/>
  <link sizes="72x72" rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-72-precomposed.png"/>
  <link rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-57-precomposed.png"/>
  <link rel="shortcut icon" href="dist/favicon.png"/>

</head>
<body data-feedly-mini="yes">
	<div id="segment-header" class="segment">  <!-- segment-header -->	
		<div class="container">  <!-- container -->
			<a id="logo" no-external="true" href="http://cql.hl7.org"><img alt="logo hl7" src="dist/hl7-logo.png"/> </a>
			<div id="hl7-status">
				<b>Clinical Quality Language Release 1 STU 3 (1.3)</b>
			</div>       	
			
			<div id="hl7-nav">
				 <a id="hl7-logo" no-external="true" href="http://www.hl7.org/">
					<img height="50" alt="visit the hl7 website" width="42" src="dist/hl7-logo.png"/>
				</a> 
			</div>       	
			<!--<div id="hl7-nav"><a id="hl7-logo" no-external="true" href="http://cql.hl7.org/search.cfm"><img alt="Search CQL" src="dist/search.png"/></a></div>-->
		</div>
		<div class="container">  <!-- container -->
	</div></div>  <!-- /segment-header -->	

	<div id="segment-navbar" class="segment">  <!-- segment-navbar -->
		<div id="stripe"> </div>
		<div class="container">  <!-- container -->
   <!-- HEADER CONTENT -->
 	      		
 	      		      		
			<nav class="navbar navbar-inverse">
				<div class="container">
					<button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
					</button>
					<a class="navbar-brand hidden" href="index.html">CQL</a>
					<div class="nav-collapse collapse navbar-inverse-collapse">
						<ul class="nav navbar-nav">
              <li class = "dropdown">
				  <a href="index.html" class = "dropbtn">Documentation</a>
			  <div class = "dropdown-content">
				  <a href="01-introduction.html">Chapter 1 - Introduction</a>
				  <a href="02-authorsguide.html">Chapter 2 - Author's Guide</a>
				  <a href="03-developersguide.html">Chapter 3 - Developer's Guide</a>
				  <a href="04-logicalspecification.html">Chapter 4 - Logical Specification</a>
				  <a href="05-languagesemantics.html">Chapter 5 - Language Semantics</a>
				  <a href="06-translationsemantics.html">Chapter 6 - Translation Semantics</a>
				  <a href="07-physicalrepresentation.html">Chapter 7 - Physical Representation</a>
				  <a href="08-a-cqlsyntax.html">Appendix A - CQL Syntax Formal Specification</a>
				  <a href="09-b-cqlreference.html">Appendix B - CQL Reference</a>
				  <a href="10-c-referenceimplementations.html">Appendix C - Reference Implementations</a>
				  <a href="11-d-references.html">Appendix D - References</a>
				  <a href="12-e-acronyms.html">Appendix E - Acronyms</a>
				  <a href="13-f-glossary.html">Appendix F - Glossary</a>
				  <a href="14-g-formattingconventions.html">Appendix G - Formatting Conventions</a>
				  <a href="15-h-timeintervalcalculations.html">Appendix H - Time Interval Calculation Examples</a>
				  <a href="16-i-fhirpathtranslation.html">Appendix I - FHIRPath Function Translation</a>
				  <a href="17-j-listoftables.html">Appendix J - List Of Tables</a>
				  <a href="18-k-listoffigures.html">Appendix K - List Of Figures</a>
			  </div>
			  </li>
              <li><a href="grammar.html">Grammar</a></li>
			  <li><a href="elm.html">ELM</a></li>
			  <li><a href="examples.html">Examples</a></li>
              <li><a href="tests.html">Tests</a></li>
              <li><a href="history.html">Version History</a><!--current--></li>

						</ul>
					</div>  <!-- /.nav-collapse -->

          </div>  <!-- /.container -->
			</nav>  <!-- /.navbar -->
      		
				
  <!-- /HEADER CONTENT -->				
		</div>  <!-- /container -->
	</div>  <!-- /segment-navbar -->
	
	<div id="segment-content" class="segment">  <!-- segment-content -->
	<div class="container">  <!-- container -->
            <div class="row">
            	<div class="inner-wrapper">
  <!-- CONTENT CONTENT -->


<div class="col-9">
    
<table class="cols"><tbody><tr><td id="wg"><a href="http://www.hl7.org/special/committees/dss/index.cfm" _target="blank">Clinical Decision Support</a> Work Group</td><td id="fmm"><a href="http://hl7.org/fhir/resource.html#maturity">Maturity Level</a>: 4</td><td id="ballot"><a href="http://hl7.org/fhir/help.html#status">Ballot Status</a>: STU 3</a></td></tr></tbody></table>


	<h1>Appendix H – Time Interval Calculation Examples</h1>



	<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#calculating-duration-in-years">1. Calculating Duration in Years</a>
<ul class="sectlevel2">
<li><a href="#definition">1.1. Definition</a></li>
<li><a href="#examples">1.2. Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-months">2. Calculating Duration in Months</a>
<ul class="sectlevel2">
<li><a href="#definition-1">2.1. Definition</a></li>
<li><a href="#examples-1">2.2. Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-weeks">3. Calculating Duration in Weeks</a>
<ul class="sectlevel2">
<li><a href="#definition-2">3.1. Definition</a></li>
<li><a href="#examples-2">3.2. Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-days">4. Calculating Duration in Days</a>
<ul class="sectlevel2">
<li><a href="#definition-3">4.1. Definition</a></li>
<li><a href="#examples-3">4.2. Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-hours">5. Calculating Duration in Hours</a>
<ul class="sectlevel2">
<li><a href="#definition-4">5.1. Definition</a></li>
<li><a href="#examples-4">5.2. Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-minutes">6. Calculating Duration in Minutes</a>
<ul class="sectlevel2">
<li><a href="#definition-5">6.1. Definition</a></li>
<li><a href="#examples-5">6.2. Examples</a></li>
</ul>
</li>
<li><a href="#difference-calculations">7. Difference Calculations</a>
<ul class="sectlevel2">
<li><a href="#examples-6">7.1. Examples</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>To determine the length of time between two dates, CQL provides two different approaches, <em>duration</em>, the number of whole periods between two dates, and <em>difference</em>, the number of period boundaries crossed between two dates.</p>
</div>
<div class="paragraph">
<p>The first approach, calculating the <em>duration</em>, determines the number of whole periods that occur between the two dates. Conceptually, the calculation is performed by considering the two dates on a timeline, and counting the number of whole periods that fit on that timeline between the two dates. For example:</p>
</div>
<div class="paragraph">
<p>Date 1: 2012-03-10<br/>
Date 2: 2013-03-10<br/>
Duration In Years: years between Date1 and Date2</p>
</div>
<div class="paragraph">
<p>The Duration In Years expression gives one year, because an entire year has passed between the two dates. Note that time is considered for the purposes of calculating the number of years:</p>
</div>
<div class="paragraph">
<p>DateTime 1: 2012-03-10 10:20:00<br/>
DateTime 2: 2013-03-10 09:20:00<br/>
Duration in Years: years between DateTime1 and DateTime2</p>
</div>
<div class="paragraph">
<p>This expression gives zero years, because the year has not passed until 10:20:00 on the day in the following year. To calculate the number of years, ignoring the time, extract the date from the date/time value:</p>
</div>
<div class="paragraph">
<p>DateTime 1: 2012-03-10 10:20:00<br/>
DateTime 2: 2013-03-10 09:20:00<br/>
Duration In Years: years between (date from DateTime1) and (date from DateTime2)</p>
</div>
<div class="paragraph">
<p>The second approach, calculating the <em>difference</em>, determines the number of boundaries crossed between two dates. To illustrate the difference, consider the following example:</p>
</div>
<div class="paragraph">
<p>Date 1: 2012-12-31<br/>
Date 2: 2013-01-01<br/>
Duration In Years: years between Date1 and Date2<br/>
Difference In Years: difference in years between Date1 and Date2</p>
</div>
<div class="paragraph">
<p>The Duration In Years expression returns zero because a full year has not passed between the two dates. However, the Difference In Years expression returns 1 because one year boundary was crossed between the two dates.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-years"><a class="anchor" href="#calculating-duration-in-years"></a>1. Calculating Duration in Years</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition"><a class="anchor" href="#definition"></a>1.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a <em>year</em> is defined as the duration of any time interval which starts at a certain time of day at a certain calendar date of the calendar year and ends at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The same time of day on the same calendar date of the next calendar year, if it exists</p>
</li>
<li>
<p>The same time of day on the immediately following calendar date of the next calendar year, if the same calendar date of the next calendar year does not exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note:</strong> When in the next calendar year the same calendar date does not exist, the ISO states that the ending calendar day has to be agreed upon. The above convention is used in CQL as a resolution to this issue.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>1.2. Examples</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Month (date 2) <span class="sym">&lt;</span> month (date 1): Duration (years) <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">-</span> 1</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-<strong>03</strong>-10 22:05:09<br/>
Date 2: 2013-<strong>02</strong>-18 19:10:03<br/>
Duration <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">-</span> 1 <span class="sym">=</span> 2013 <span class="sym">-</span> 2012 <span class="sym">-</span> 1 <span class="sym">=</span> <strong>0 years</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Month (date 2) <span class="sym">=</span> month (date 1) and day (date 2) <span class="sym">&gt;=</span> day (date 1)<br/>
Duration (years) <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 2.a:</strong> day (date 1) <span class="sym">=</span> day (date 2)<br/>
Date 1: 2012-03-<strong>10</strong> 22:05:09<br/>
Date 2: 2013-03-<strong>10</strong> 22:05:09<br/>
Duration <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">=</span> 2013 <span class="sym">-</span> 2012 <span class="sym">=</span> <strong>1 year</strong></p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Time of day is important in this calculation. If the time of day of Date 2 were less than the time of day for Date 1, the duration of the time interval would be 0 years according to the definition.</p>
</div>
<div class="paragraph">
<p><strong>Example 2.b:</strong> day (date 2) <span class="sym">&gt;</span> day (date 1)<br/>
Date 1: 2012-03-10 22:05:09<br/>
Date 2: 2013-03-20 04:01:30<br/>
Duration <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">=</span> 2013 <span class="sym">-</span> 2012 <span class="sym">=</span> <strong>1 year</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Month (date 2) <span class="sym">=</span> month (date 1) and day (date 2) <span class="sym">&lt;</span> day (date 1)<br/>
Duration (years) <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">-</span> 1</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 3.a:</strong><br/>
Date 1: 2012-02-29<br/>
Date 2: 2014-02-28<br/>
Duration <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">-</span> 1 <span class="sym">=</span> 2014 <span class="sym">-</span> 2012 <span class="sym">-</span> 1 <span class="sym">=</span> <strong>1 year</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Month (date 2) <span class="sym">&gt;</span> month (date 1)<br/>
Duration (years) <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 4.a:</strong><br/>
Date 1: 2012-<em>03</em>-10 11:16:02<br/>
Date 2: 2013-<em>08</em>-15 21:34:16<br/>
Duration <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">=</span> 2013 <span class="sym">-</span> 2012 <span class="sym">-</span> <strong>1 year</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 4.b:</strong><br/>
Date 1: 2012-<em>02</em>-29 10:18:56<br/>
Date 2: 2014-<em>03</em>-01 19:02:34<br/>
Duration <span class="sym">=</span> year (date 2) <span class="sym">-</span> year (date 1) <span class="sym">=</span> 2014 <span class="sym">-</span> 2012 <span class="sym">=</span> <strong>2 years</strong></p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Because there is no February 29 in 2014, the number of years can only change when the date reaches March 1, the first date in 2014 that surpasses the month and day of date 1 (Feburary 29).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-months"><a class="anchor" href="#calculating-duration-in-months"></a>2. Calculating Duration in Months</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-1"><a class="anchor" href="#definition-1"></a>2.1. Definition</h3>
<div class="paragraph">
<p>A month in CQL is defined as the duration of any time interval which starts at a certain time of day at a certain calendar day of the calendar month and ends at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The same time of day at the same calendar day of the ending calendar month, if it exists</p>
</li>
<li>
<p>The same time of day at the immediately following calendar date of the ending calendar month, if the same calendar date of the ending month in the ending year does not exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Notes:</strong> When in the next calendar year the same calendar date does not exist, the ISO states that the ending calendar day has to be agreed upon. The above convention is used in CQL as a resolution to this issue.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-1"><a class="anchor" href="#examples-1"></a>2.2. Examples</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Day (date 2) <span class="sym">&gt;=</span> day (date 1)<br/>
Duration (months) <span class="sym">=</span> (year (date 2) <span class="sym">-</span> year (date 1)) <span class="sym">*</span> 12 <span class="sym">+</span> (month (date 2) <span class="sym">-</span> month (date 1))</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 1.a:</strong><br/>
Date 1: 2012-03-01 14:05:45<br/>
Date 2: 2012-03-31 23:01:49<br/>
Duration <span class="sym">=</span> (year (date 2) <span class="sym">-</span> year (date 1)) <span class="sym"><strong></span> 12 <span class="sym">+</span> (month (date 2) <span class="sym">-</span> (month (date 1))<br/>
= (2012 <span class="sym">-</span> 2012) * 12 + (3 - 3) = *0 months</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 1.b:</strong><br/>
Date 1: 2012-03-10 22:05:09<br/>
Date 2: 2013-06-30 13:00:23<br/>
Duration <span class="sym">=</span> (year (date 2) <span class="sym">-</span> year (date 1)) <span class="sym"><strong></span> 12 <span class="sym">+</span> (month (date 2) <span class="sym">-</span> (month date 1))<br/>
= (2013 - 2012) * 12 + (6 - 3) = 12 + 3 = *15 months</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Day (day 2) <span class="sym">&lt;</span> day (date 1)<br/>
Duration (months) <span class="sym">=</span> (year (date 2) <span class="sym">-</span> year (date 1)) <span class="sym">*</span> 12 <span class="sym">+</span> (month (date 2) <span class="sym">-</span> month (date 1)) <span class="sym">-</span> 1</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2012-03-10 22:05:09<br/>
Date 2: 2013-01-09 07:19:33<br/>
Duration <span class="sym">=</span> (year (date 2) <span class="sym">-</span> year (date 1)) <span class="sym"><strong></span> 12 <span class="sym">+</span> (month (date 2) <span class="sym">-</span> month (date 1)) <span class="sym">-</span> 1<br/>
= (2013 - 2012) * 12 + (1 - 3) - 1 = 12 - 2 - 1 = *9 months</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-weeks"><a class="anchor" href="#calculating-duration-in-weeks"></a>3. Calculating Duration in Weeks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-2"><a class="anchor" href="#definition-2"></a>3.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a week is defined as a duration of any time interval which starts at a certain time of day at a certain calendar day at a certain calendar week and ends at the same time of day at the same calendar day of the ending calendar week. In other words, a complete week is always seven days long.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-2"><a class="anchor" href="#examples-2"></a>3.2. Examples</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Duration <span class="sym">=</span> <span class="date 2 [.sym">-</span> date 1 (days)] <span class="sym">/</span> 7</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-10 22:05:09<br/>
Date 2: 2012-03-20 07:19:33<br/>
Duration <span class="sym">=</span> <span class="[.sym">#</span> days (month (date 1)) <span class="sym">-</span> day (date 1) <span class="sym">+</span> # days (month (date 1) + 1) + # days (month (date 1) + 2) + <span class="sym">&#8230;&#8203;</span> + # days (month (date 2) <span class="sym">-</span> 1) + day (date 2)] <span class="sym">/</span> 7<br/>
= (20 - 10) / 7 = 10 / 7 = <strong>1 week</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-days"><a class="anchor" href="#calculating-duration-in-days"></a>4. Calculating Duration in Days</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-3"><a class="anchor" href="#definition-3"></a>4.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a day is defined as a duration of any time interval which starts at a certain calendar day and ends at the next calendar day (1 second to 23 hours, 59 minutes, and 59 seconds).</p>
</div>
<div class="paragraph">
<p>The duration in days between two dates will generally be given by subtracting the start calendar date from the end calendar date, respecting the time of day between the two dates.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-3"><a class="anchor" href="#examples-3"></a>4.2. Examples</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Time (date 2) <span class="sym">&lt;</span> time (date 1)<br/>
Duration <span class="sym">=</span> <span class="date 2 [.sym">-</span> date 1 (days)] <span class="sym">-</span> 1</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-01-31 12:30:00<br/>
Date 2: 2012-02-01 09:00:00<br/>
Duration <span class="sym">=</span> 02-01 <span class="sym">-</span> 01-31 - 1 <span class="sym">=</span> <strong>0 days</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Time (date 2) <span class="sym">&gt;=</span> time (date 1)<br/>
Duration <span class="sym">=</span> date 2 <span class="sym">-</span> date 1 (days)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2012-01-31 12:30:00<br/>
Date 2: 2012-02-01 14:00:00<br/>
Duration <span class="sym">=</span> 02-01 <span class="sym">-</span> 01-31 <span class="sym">=</span> <strong>1 day</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-hours"><a class="anchor" href="#calculating-duration-in-hours"></a>5. Calculating Duration in Hours</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-4"><a class="anchor" href="#definition-4"></a>5.1. Definition</h3>
<div class="paragraph">
<p>In CQL, an hour is defined as 60 minutes. The duration in hours between two dates is the number of minutes between the two dates, divided by 60. The result is truncated to the unit.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-4"><a class="anchor" href="#examples-4"></a>5.2. Examples</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-01 03:10:00<br/>
Date 2: 2012-03-01 05:09:00<br/>
Duration <span class="sym">=</span> <strong>1 hour</strong></p>
</li>
<li>
<p><strong>Example 2:</strong><br/>
Date 1: 2012-02-29 23:10:00<br/>
Date 2: 2012-03-01 00:10:00<br/>
Duration <span class="sym">=</span> <strong>1 hour</strong></p>
</li>
<li>
<p><strong>Example 3:</strong><br/>
Date 1: 2012-03-01 03:10<br/>
Date 2: 2012-03-01 04:00<br/>
Duration <span class="sym">=</span> <strong>0 hours</strong></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-minutes"><a class="anchor" href="#calculating-duration-in-minutes"></a>6. Calculating Duration in Minutes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-5"><a class="anchor" href="#definition-5"></a>6.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a minute is defined as 60 seconds. The duration in minutes between two dates is the number of seconds between the two dates, divided by 60. The result is truncated to the unit.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-5"><a class="anchor" href="#examples-5"></a>6.2. Examples</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-01 03:10:00<br/>
Date 2: 2012-03-01 05:20:00<br/>
Duration <span class="sym">=</span> <strong>130 minutes</strong></p>
</li>
<li>
<p><strong>Example 2:</strong><br/>
Date 1: 2012-02-29 23:10:00<br/>
Date 2: 2012-03-01 00:20:00<br/>
Duration <span class="sym">=</span> <strong>70 minutes</strong></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="difference-calculations"><a class="anchor" href="#difference-calculations"></a>7. Difference Calculations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Difference calculations are performed by truncating the date/time values at the next precision, and then performing the corresponding duration calculation on the truncated values.</p>
</div>
<div class="paragraph">
<p>Implementations need to consider the calculation of the "difference between" two date/times with different timezone offsets. There are multiple use cases when this might occur, but the most prevalent is likely due to Daylight Saving Time (DST).</p>
</div>
<div class="paragraph">
<p>To support the expected results in all cases, normalization of date/time values may be needed, depending on the precision used in the difference calculation. Normalization refers to adjustment of one or both of the two date/time values used in the difference calculation, if the timezone offsets are not the same, to a common timezone offset (namely, the timezone offset of the evaluation request timestamp).</p>
</div>
<div class="paragraph">
<p>When difference is calculated for hours or finer units, timezone offsets should be normalized prior to truncation to correctly consider real (actual elapsed) time. When difference is calculated for days or coarser units, however, the time components (including timezone offset) should be truncated without normalization to correctly reflect the difference in calendar days, months, and years.</p>
</div>
<div class="sect2">
<h3 id="examples-6"><a class="anchor" href="#examples-6"></a>7.1. Examples</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-01 03:10:00<br/>
Date 2: 2012-12-31 10:10:00<br/>
Difference (years) <span class="sym">=</span> Duration (years) between 2012-01-01 00:00:00 and 2012-01-01 00:00:00<br/>
Difference (years) <span class="sym">=</span> <strong>0</strong></p>
</li>
<li>
<p><strong>Example 2:</strong><br/>
Date 1: 2012-12-31 03:10:00<br/>
Date 2: 2013-01-01 10:10:00<br/>
Difference (years) <span class="sym">=</span> Duration (years) between 2012-01-01 00:00:00 and 2013-01-01 00:00:00<br/>
Difference (years) <span class="sym">=</span> <strong>1</strong></p>
</li>
<li>
<p><strong>Example 3:</strong><br/>
Date 1: 2016-10-10 09:00:00<br/>
Date 2: 2016-10-11 11:59:00<br/>
Difference (days) <span class="sym">=</span> Duration (days) between 2016-10-10 00:00:00 and 2016-10-11 00:00:00<br/>
Difference (days) <span class="sym">=</span> <strong>1</strong></p>
</li>
<li>
<p><strong>Example 4:</strong><br/>
Date 1: 2016-10-10 09:00:00<br/>
Date 2: 2016-10-12 00:00:00<br/>
Difference (days) <span class="sym">=</span> Duration (days) between 2016-10-10 00:00:00 and 2016-10-12 00:00:00<br/>
Difference (days) <span class="sym">=</span> <strong>2</strong></p>
</li>
<li>
<p><strong>Example 5:</strong><br/>
Date 1: 2017-03-12 01:12:05.1 (-05:00)<br/>
Date 2: 2017-03-12 03:22:27.6 (-04:00)<br/>
Date 2 (normalized): 2017-03-12 02:22:27.6 (-05:00)<br/>
Difference (hours) <span class="sym">=</span> Duration (hours) between 2017-03-12 01:00:00.0 (-05:00) and 2017-03-12 02:00:00.0 (-05:00)<br/>
On the day that DST goes into effect, one might compare<br/>
1:00am Eastern Standard Time (EST) 2017-03-12 01:00:00.0 (-05:00) to<br/>
3:00am Eastern Daylight Time (EDT) 2017-03-12 03:00:00.0 (-04:00)<br/>
Since time "springs forward" at 2:00am, only one hour of <em>real</em> time has elapsed.<br/>
To calculate the "difference in hours" as 1, the second time (3:00am EDT) is normalized to the first time&#8217;s offset (making it 2:00am EST).<br/>
The difference between 1:00am EST and 2:00am EST is clearly one hour.<br/>
In a clinical setting, recognizing this as only one hour (and not two, as the clock might suggest) is important.</p>
</li>
<li>
<p><strong>Example 6:</strong><br/>
Date 1: 2017-11-05 01:30:00.0 (-04:00)<br/>
Date 2: 2017-11-05 01:15:00.0 (-05:00)<br/>
Date 2 (normalized): 2017-11-05 02:15:00.0 (-04:00)<br/>
Difference (minutes) <span class="sym">=</span> Duration (minutes) between 2017-11-05 01:30:00.0 (-04:00) and 2017-11-05 02:15:00.0 (-04:00)<br/>
Similarly, when DST ends, one might compare 1:30am EDT to 1:15am EST.<br/>
If we did not respect timezone offsets, the difference would appear to be -15 minutes.<br/>
Again, to calculate the "difference in minutes" as 45, the second time (1:15am EST) is normalized to the first time&#8217;s offset (making it 2:15am EDT).<br/>
The difference between 1:30am EDT and 2:15am EDT is clearly 45 minutes.</p>
</li>
<li>
<p><strong>Example 7:</strong><br/>
Date 1: 2017-03-12 00:00:00.0 (-05:00)<br/>
Date 2: 2017-03-13 00:00:00.0 (-04:00)<br/>
Without normalization of the dates:<br/>
Difference (days) <span class="sym">=</span> Duration (days) between 2017-03-12 00:00:00.0 and 2017-03-13 00:00:00.0<br/>
In some cases, normalization prior to truncation may give unexpected results. Consider the "difference in days" between midnight (EST) on the day that DST goes into effect and midnight (EDT) the next day. One would expect that since the second date is the "next day" on the calendar, difference in days should be 1.<br/>
With normalization prior to truncation, the second date would become 11:00pm EST on the same day as the first date.<br/>
The difference in days would be 0, which is not the expected result.</p>
</li>
</ol>
</div>
</div>
</div>
</div>


</div>


				</div>  <!-- /inner-wrapper -->
            </div>  <!-- /row -->
        </div>  <!-- /container -->
        
    </div>  <!-- /segment-content -->


	<div id="segment-footer" class="segment">  <!-- segment-footer -->
		<div class="container">  <!-- container -->
			<div class="inner-wrapper">
				<p>
        &copy; HL7.org 2014+. CQL STU3 (1.3 Release) generated on 2019-03-17 11:17:12 -0600
        <span style="color: #FFFF77">| 
<!--               <a style="color: #81BEF7" href="http://services.w3.org/htmldiff?doc1=http%3A%2F%2Fcql.hl7.org%2FSTU2%2F<%rellink%>&amp;doc2=<%baseURL%><%rellink%>">Compare to STU2</a> | -->
               <a style="color: #81BEF7" rel="license" href="license.html">License</a> |
               <a style="color: #81BEF7" target="_blank" href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=400">Propose a change</a>
        </span>
        </p>
			</div>  <!-- /inner-wrapper -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-footer -->

	
	<div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
		<div class="container">  <!-- container -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-post-footer -->
    
      <!-- JS and analytics only. -->
      <!-- Bootstrap core JavaScript
================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
<script src="dist/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
<script src="dist/bootstrap.min.js"> </script>
<script src="dist/respond.min.js"> </script>
<script src="dist/fhir.js"> </script>
<script src="dist/sidebar.js"> </script>

  <!-- Analytics Below
================================================== -->


<div id="feedly-mini" title="feedly Mini tookit"></div></body></html>




